@page
@model OnlineLearningPlatformAss2.RazorWebApp.Pages.Admin.CourseModerationModel
@{
    ViewData["Title"] = "Course Moderation";
}

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-0">Course Moderation</h2>
            <p class="text-muted">Review and manage course submissions across the platform.</p>
        </div>
        <a asp-page="/Admin/Dashboard" class="btn btn-link text-decoration-none">
            <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
        </a>
    </div>

    @if (!Model.PendingCourses.Any())
    {
        <div class="card border-0 shadow-sm p-5 text-center">
            <div class="mb-3">
                <i class="bi bi-check2-circle text-success display-1"></i>
            </div>
            <h4 class="fw-bold">All caught up!</h4>
            <p class="text-muted mb-0">There are no pending course submissions at the moment.</p>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var course in Model.PendingCourses)
            {
                <div class="col-12" id="course-@course.Id">
                    <div class="card border-0 shadow-sm overflow-hidden h-100">
                        <div class="row g-0 h-100">
                            <div class="col-md-3">
                                <img src="@(course.ImageUrl ?? "https://via.placeholder.com/400x225")" class="img-fluid h-100 object-fit-cover" alt="@course.Title">
                            </div>
                            <div class="col-md-9">
                                <div class="card-body p-4 d-flex flex-column h-100">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <span class="badge bg-primary bg-opacity-10 text-primary mb-2">@course.CategoryName</span>
                                            <h4 class="fw-bold mb-1">@course.Title</h4>
                                            <p class="text-muted small mb-0">by <span class="fw-semibold text-dark">@course.InstructorName</span> â€¢ Submitted on @DateTime.UtcNow.ToString("MMM dd, yyyy")</p>
                                        </div>
                                        <h4 class="fw-bold text-primary mb-0">@course.Price.ToString("C")</h4>
                                    </div>
                                    <div class="mt-auto pt-3 border-top d-flex justify-content-between align-items-center">
                                        <div class="btn-group">
                                            <a asp-page="/Course/Details" asp-route-id="@course.Id" target="_blank" class="btn btn-outline-secondary btn-sm rounded-pill px-4">
                                                <i class="bi bi-eye me-2"></i>Preview Content
                                            </a>
                                        </div>
                                        <div>
                                            <button class="btn btn-danger btn-sm rounded-pill px-4 me-2" onclick="rejectCourse('@course.Id')">
                                                <i class="bi bi-x-circle me-2"></i>Reject
                                            </button>
                                            <button class="btn btn-success btn-sm rounded-pill px-4" onclick="approveCourse('@course.Id')">
                                                <i class="bi bi-check-circle me-2"></i>Approve & Publish
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@section Scripts {
<script>
    async function approveCourse(id) {
        if(!confirm('Approve and publish this course?')) return;
        const response = await fetch(`?handler=Approve&id=${id}`, {
            method: 'POST',
            headers: { 'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() }
        });
        if (response.ok) {
            $(`#course-${id}`).fadeOut(300, function() { $(this).remove(); if($('.col-12').length == 0) location.reload(); });
        }
    }

    async function rejectCourse(id) {
        if(!confirm('Reject this course submission?')) return;
        const response = await fetch(`?handler=Reject&id=${id}`, {
            method: 'POST',
            headers: { 'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() }
        });
        if (response.ok) {
            $(`#course-${id}`).fadeOut(300, function() { $(this).remove(); if($('.col-12').length == 0) location.reload(); });
        }
    }
</script>
}
